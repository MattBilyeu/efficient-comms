"use strict";(self.webpackChunkangular_frontend=self.webpackChunkangular_frontend||[]).push([[358],{1358:(N,h,l)=>{l.r(h),l.d(h,{UserModule:()=>O});var p=l(6814),g=l(5763),t=l(9291);const v=[];let T=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a});static#i=this.\u0275inj=t.cJS({imports:[g.Bz.forChild(v),g.Bz]})}return a})();class Z{constructor(r,e,i,s,o,d,c){this.title=r,this.notes=e,this.files=i,this.teamId=s,this.ownerId=o,this.ownerName=d,this.stage=c}}var u=l(2848),f=l(1269),n=l(95),m=l(1781),_=l(6593);function S(a,r){if(1&a&&(t.TgZ(0,"a",14),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("href",e,t.LSH),t.xp6(1),t.Oqu(e)}}function b(a,r){1&a&&t._UZ(0,"div",15),2&a&&t.Q6J("innerHTML",r.$implicit,t.oJD)}let C=(()=>{class a{constructor(e,i,s){this.dataService=e,this.domSanitizer=i,this.httpService=s,this.deleted=new t.vpe,this.fileUrls=[],this.editorConfig={base_url:"/tinymce",suffix:".min",plugins:"lists link table",toolbar:"numlist bullist link table"}}ngOnInit(){this.escalation=this.dataService.team.escalations.filter(e=>e._Id===this.eId)[0],Array.isArray(this.escalation.files)&&"string"==typeof this.escalation.files[0]&&(this.fileUrls=this.escalation.files),this.sanitizeNotes()}sanitizeNotes(){const e=this.escalation.notes.map(i=>this.domSanitizer.bypassSecurityTrustHtml(i));this.escalation={...this.escalation,notes:e}}chooseFiles(e){this.fileList=e.target.files}advanceEscalation(e){this.httpService.advanceEscalationo({escalationId:this.eId,note:e.value.note,files:this.fileList}).subscribe(s=>{this.alert=s.message})}deleteEscalation(){prompt("Are you sure you want to resolve this escalation?  It will permanently remove it.")&&this.httpService.deleteEscalation(this.eId).subscribe(i=>{this.alert=i.message}),this.deleted.emit(!0)}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(u.D),t.Y36(_.H7),t.Y36(f.O))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-escalation-detail"]],inputs:{eId:"eId"},decls:20,vars:4,consts:[[1,"container"],[1,"viewEscalation"],[1,"inputsContainer"],[3,"ngSubmit"],["a","ngForm"],["for","note"],["id","note","name","note","ngModel","","required","",3,"init"],["for","files"],["type","file","name","files","id","files","multiple","","ngModel","",3,"change"],["type","submit"],["type","button",3,"click"],[1,"files"],["target","_blank",3,"href",4,"ngFor","ngForOf"],["class","escalationNotes",3,"innerHTML",4,"ngFor","ngForOf"],["target","_blank",3,"href"],[1,"escalationNotes",3,"innerHTML"]],template:function(i,s){if(1&i){const o=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3,4),t.NdJ("ngSubmit",function(){t.CHM(o);const c=t.MAs(4);return t.KtG(s.advanceEscalation(c))}),t.TgZ(5,"h3"),t._uU(6),t.qZA(),t.TgZ(7,"label",5),t._uU(8,"Note: "),t.qZA(),t._UZ(9,"editor",6),t.TgZ(10,"label",7),t._uU(11,"Files:"),t.qZA(),t.TgZ(12,"input",8),t.NdJ("change",function(c){return s.chooseFiles(c)}),t.qZA(),t.TgZ(13,"button",9),t._uU(14,"Advance Escalation"),t.qZA()(),t.TgZ(15,"button",10),t.NdJ("click",function(){return s.deleteEscalation()}),t._uU(16,"Resolve Escalation"),t.qZA()(),t.TgZ(17,"div",11),t.YNc(18,S,2,2,"a",12),t.qZA(),t.YNc(19,b,1,1,"div",13),t.qZA()()}2&i&&(t.xp6(6),t.Oqu(s.escalation.title),t.xp6(3),t.Q6J("init",s.editorConfig),t.xp6(9),t.Q6J("ngForOf",s.fileUrls),t.xp6(1),t.Q6J("ngForOf",s.escalation.notes))},dependencies:[p.sg,n._Y,n.Fj,n.JJ,n.JL,n.Q7,n.On,n.F,m.PG]})}return a})();const y=["files"];function E(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"app-escalation-detail",12),t.NdJ("deleted",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.updateComponent())}),t.qZA()}2&a&&t.Q6J("eId",r.$implicit._Id)}let U=(()=>{class a{constructor(e,i){this.dataService=e,this.httpService=i,this.editorConfig={base_url:"/tinymce",suffix:".min",plugins:"lists link table",toolbar:"numlist bullist link table"}}ngOnInit(){this.escalations=this.filterEscalations(this.dataService.team.escalations)}updateComponent(){this.httpService.getPopulatedTeam(this.dataService.user.teamId).subscribe(e=>{"message"in e?this.alert=e.message:(this.dataService.team=e,this.escalations=this.filterEscalations(e.escalations))})}filterEscalations(e){let i;return e.forEach(s=>{("Member"===s.stage&&s.ownerId===this.dataService.user._Id||"Peer Review"===s.stage&&this.dataService.user.peerReviewer||"Manager"===s.stage&&"Manager"===this.dataService.user.role)&&i.push(s)}),i}chooseFiles(e){this.fileList=e.target.files}createEscalation(e){const i=new Z(e.value.title,[e.value.note],this.fileList,this.dataService.user.teamId,this.dataService.user._Id,this.dataService.user.name,"");let s=!1;for(let o=0;o<this.dataService.team.users.length;o++)this.dataService.team.users[o].peerReviewer&&(s=!0);i.stage=s?"Peer Review":"Manager",this.httpService.createEscalation(i).subscribe(o=>{this.alert=o.message})}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(u.D),t.Y36(f.O))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-escalations"]],viewQuery:function(i,s){if(1&i&&t.Gf(y,5),2&i){let o;t.iGM(o=t.CRH())&&(s.fileInput=o.first)}},decls:16,vars:2,consts:[[1,"container"],[3,"ngSubmit"],["c","ngForm"],[1,"group"],["for","title"],["type","text","id","title","name","title","ngModel","","required",""],["for","files"],["type","file","name","files","id","files","multiple","","ngModel","",3,"change"],["for","note"],["id","note","name","note","ngModel","","required","",3,"init"],["type","submit"],[3,"eId","deleted",4,"ngFor","ngForOf"],[3,"eId","deleted"]],template:function(i,s){if(1&i){const o=t.EpF();t.TgZ(0,"div",0)(1,"form",1,2),t.NdJ("ngSubmit",function(){t.CHM(o);const c=t.MAs(2);return t.KtG(s.createEscalation(c))}),t.TgZ(3,"div",3)(4,"label",4),t._uU(5,"Title: "),t.qZA(),t._UZ(6,"input",5),t.qZA(),t.TgZ(7,"label",6),t._uU(8,"Files:"),t.qZA(),t.TgZ(9,"input",7),t.NdJ("change",function(c){return s.chooseFiles(c)}),t.qZA(),t.TgZ(10,"label",8),t._uU(11,"Note: "),t.qZA(),t._UZ(12,"editor",9),t.TgZ(13,"button",10),t._uU(14,"Create Escalation"),t.qZA()(),t.YNc(15,E,1,1,"app-escalation-detail",11),t.qZA()}2&i&&(t.xp6(12),t.Q6J("init",s.editorConfig),t.xp6(3),t.Q6J("ngForOf",s.escalations))},dependencies:[p.sg,n._Y,n.Fj,n.JJ,n.JL,n.Q7,n.On,n.F,m.PG,C]})}return a})();function F(a,r){if(1&a&&(t.TgZ(0,"a",6),t._uU(1),t.qZA()),2&a){const e=r.$implicit;t.Q6J("href",e,t.LSH),t.xp6(1),t.Oqu(e)}}let I=(()=>{class a{constructor(e,i,s){this.httpService=e,this.dataService=i,this.domSanitizer=s,this.acknowledged=new t.vpe}ngOnInit(){this.update=this.dataService.team.updates.filter(e=>e._Id===this.updateId)[0],Array.isArray(this.update.files)&&"string"==typeof this.update.files[0]&&(this.fileUrls=this.update.files),this.sanitizedText=this.domSanitizer.bypassSecurityTrustHtml(this.update.text)}acknowledgeUpdate(){this.httpService.acknowledgeUpdate(this.updateId).subscribe(e=>{this.alert=e.message,"Update acknowledged."===e.message&&this.httpService.getPopulatedTeam(this.dataService.user.teamId).subscribe(i=>{this.dataService.team=i,this.acknowledged.emit(!0)})})}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(f.O),t.Y36(u.D),t.Y36(_.H7))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-update-detail"]],inputs:{updateId:"updateId"},decls:9,vars:3,consts:[[1,"container"],[1,"viewEscalation"],[3,"innerHTML"],[1,"files"],["target","_blank",3,"href",4,"ngFor","ngForOf"],["type","button",3,"click"],["target","_blank",3,"href"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3"),t._uU(3),t.qZA(),t._UZ(4,"div",2),t.TgZ(5,"div",3),t.YNc(6,F,2,2,"a",4),t.qZA(),t.TgZ(7,"button",5),t.NdJ("click",function(){return s.acknowledgeUpdate()}),t._uU(8,"Resolve Escalation"),t.qZA()()()),2&i&&(t.xp6(3),t.Oqu(s.update.title),t.xp6(1),t.Q6J("innerHTML",s.sanitizedText,t.oJD),t.xp6(2),t.Q6J("ngForOf",s.fileUrls))},dependencies:[p.sg]})}return a})();function A(a,r){if(1&a){const e=t.EpF();t.TgZ(0,"app-update-detail",1),t.NdJ("acknowledged",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.updateComponent())}),t.qZA()}2&a&&t.Q6J("updateId",r.$implicit._Id)}let J=(()=>{class a{constructor(e){this.dataService=e}ngOnInit(){this.updateComponent()}updateComponent(){this.updates=this.dataService.team.updates.filter(e=>-1!==e.notAcknowledged.findIndex(s=>this.dataService.user._Id===s))}static#t=this.\u0275fac=function(i){return new(i||a)(t.Y36(u.D))};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-updates"]],decls:1,vars:1,consts:[[3,"updateId","acknowledged",4,"ngFor","ngForOf"],[3,"updateId","acknowledged"]],template:function(i,s){1&i&&t.YNc(0,A,1,1,"app-update-detail",0),2&i&&t.Q6J("ngForOf",s.updates)},dependencies:[p.sg,I]})}return a})(),w=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-user"]],decls:2,vars:0,template:function(i,s){1&i&&t._UZ(0,"app-escalations")(1,"app-updates")},dependencies:[U,J]})}return a})();var M=l(6208);let O=(()=>{class a{static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275mod=t.oAB({type:a,bootstrap:[w]});static#i=this.\u0275inj=t.cJS({providers:[{provide:m.f8,useValue:"tinymce/tinymce.min.js"}],imports:[p.ez,T,n.u5,m.Z_,M.m]})}return a})()}}]);